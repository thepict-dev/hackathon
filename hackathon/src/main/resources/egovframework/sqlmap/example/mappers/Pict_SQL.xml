<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pict_admin.service.impl.PictMapper">
	
	<select id="board_list" resultType="pictVO">
		select * from board_table
		where 1=1
		<if test="search_text != null and search_text != '' ">
			and (
				title LIKE CONCAT('%', #{search_text}, '%')
			) 
		</if>
		
		<if test="category != null and category != '' ">
			and category = #{category}
		</if>
		order by reg_date desc
	</select>
	
	<select id="board_list_one" resultType="pictVO">
		select * from board_table
		where idx = #{idx}
	</select>
	
	<insert id="board_insert" parameterType="pictVO">
		INSERT INTO board_table
			(
			 title, text, reg_date, file_1, file_2, file_3, file_4, file_5, category
			)
		VALUES (
			 #{title}, #{text}, now(), #{file_1}, #{file_2}, #{file_3}, #{file_4}, #{file_5}, #{category}
			  ) 
	</insert>
	
	<update id="board_update" parameterType="pictVO">
		update board_table
		set title =#{title}, text=#{text}, reg_date = now(), category = #{category}
		<if test="file_1 != null and file_1 != ''">
			, file_1 = #{file_1}
		</if>
		<if test="file_2 != null and file_2 != ''">
			, file_2 = #{file_2}
		</if>
		<if test="file_3 != null and file_3 != ''">
			, file_3 = #{file_3}
		</if>
		<if test="file_4 != null and file_4 != ''">
			, file_4 = #{file_4}
		</if>
		<if test="file_5 != null and file_5 != ''">
			, file_5 = #{file_5}
		</if>
		where idx = #{idx}
	</update>
	
	
	<delete id="board_delete" parameterType="pictVO">
		delete from board_table where idx = #{idx}
	</delete>
	
	<update id="board_att_del" parameterType="pictVO">
		update board_table set reg_date =now()
		<if test="del_idx != null and del_idx != '' and del_idx == 1">
			, file_1 = ''
		</if>
		<if test="del_idx != null and del_idx != '' and del_idx == 2">
			, file_2 = ''
		</if>
		<if test="del_idx != null and del_idx != '' and del_idx == 3">
			, file_3 = ''
		</if>
		<if test="del_idx != null and del_idx != '' and del_idx == 4">
			, file_4 = ''
		</if>
		<if test="del_idx != null and del_idx != '' and del_idx == 5">
			, file_5 = ''
		</if>
		
		where idx = #{idx}
	</update>
	
	
	<select id="vote_list" resultType="testVO">
		select t.title, count(v.idx) as cnt
		from vote_table v
		left outer join team_table t on v.target_id = t.idx
		group by v.target_id
		order by cnt desc
		limit 10 offset 0
	</select>
	
	<insert id="vote_insert" parameterType="pictVO">
		INSERT INTO vote_table
			(
			 target_id, reg_date
			)
		VALUES (
			 #{target_id}, now()
			  ) 
	</insert>
	
	
	<!-- 참가팀 -->
	<select id="team_list" resultType="pictVO">
		select * from team_table
		where 1=1
		<if test="search_text != null and search_text != '' ">
			and (
				title LIKE CONCAT('%', #{search_text}, '%') or assignment_name LIKE CONCAT('%', #{search_text}, '%')
			) 
		</if>

		order by reg_date desc
	</select>
	
	<select id="team_list_one" resultType="pictVO">
		select * from team_table
		where idx = #{idx}
	</select>
	
	<insert id="team_insert" parameterType="pictVO" useGeneratedKeys="true" keyProperty="idx">
		INSERT INTO team_table
			(
			 assignment_id, local, reg_date, title, team_cnt, assignment_name, keyword, file_url, award
			)
		VALUES (
			 #{assignment_id}, #{local}, now(), #{title}, #{team_cnt}, #{assignment_name}, #{keyword}, #{file_url}, #{award}
			  ) 
	</insert>
	
	<update id="team_update" parameterType="pictVO">
		update team_table
		set title =#{title}, assignment_id=#{assignment_id}, reg_date = now(), local = #{local}
		, team_cnt = #{team_cnt}, assignment_name = #{assignment_name}, keyword = #{keyword}, award = #{award}
		
		<if test="file_url != null and file_url != ''">
			, file_url = #{file_url}
		</if>
		
		where idx = #{idx}
	</update>
	
	<delete id="team_delete" parameterType="pictVO">
		delete from team_table where idx = #{idx}
	</delete>
	
	
	<!-- 참가자 -->
	<select id="user_list" resultType="pictVO">
		select * from user_table
		where 1=1
		<if test="search_text != null and search_text != '' ">
			and (
				title LIKE CONCAT('%', #{search_text}, '%') or mobile LIKE CONCAT('%', #{search_text}, '%')
			) 
		</if>

		order by reg_date desc
	</select>
	
	<select id="user_list_one" resultType="pictVO">
		select * from user_table
		where idx = #{idx}
	</select>
	
	<insert id="user_insert" parameterType="pictVO">
		INSERT INTO user_table
			(
			 team_id, name, birthday, mobile, email, company, depart, shirt, parent_name, parent_birthday, parent_mobile, parent_relation, parent_address, parent_address2, judge, reg_date
			)
		VALUES (
			 #{team_id}, #{name}, #{birthday}, #{mobile}, #{email}, #{company}, #{depart}, #{shirt}, #{parent_name}, #{parent_birthday}, #{parent_mobile}, #{parent_relation}, #{parent_address}, #{parent_address2}, #{judge}, now()
			  ) 
	</insert>
	
	<update id="user_update" parameterType="pictVO">
		update user_table
		set team_id =#{team_id}, name=#{name}, birthday = #{birthday}, mobile = #{mobile}
		, email = #{email}, company = #{company}, depart = #{depart}, shirt = #{shirt}
		, parent_name = #{parent_name}, parent_birthday = #{parent_birthday}, parent_mobile = #{parent_mobile}, parent_relation = #{parent_relation}
		, parent_address = #{parent_address}, parent_address2 = #{parent_address2}, judge = #{judge}, reg_date = now()
		
		where idx = #{idx}
	</update>
	
	<delete id="user_delete" parameterType="pictVO">
		delete from user_table where idx = #{idx}
	</delete>
	
	
	<!-- 파일함 -->
	<select id="file_list" resultType="pictVO">
		select * from drive_table
		where 1=1
		<if test="search_text != null and search_text != '' ">
			and (
				title LIKE CONCAT('%', #{search_text}, '%')
			) 
		</if>

		order by reg_date desc
	</select>
	
	
	<delete id="file_delete" parameterType="pictVO">
		delete from drive_table where idx = #{idx}
	</delete>
	
	<!-- 청중투표 -->
	<select id="vote_user_list" resultType="pictVO">
		select * from drive_table
		where 1=1

		order by reg_date desc
	</select>

	<!-- 심사평가 -->	
	<select id="judge_list" resultType="pictVO">
		select * from drive_table
		where 1=1

		order by reg_date desc
	</select>
	
	
	
	
</mapper>